/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Library;

import EBook.Libreria;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.filechooser.FileNameExtensionFilter;
import javax.swing.filechooser.*;
import java.io.File;

/**
 * <p> Title: AddBialogBox </p>
 * <p> Description :Classe che implementa l'operazione di aggiunta di un nuovo ebook alla libreria,, attraverso l'apertura di una finestra di dialogo.</p>
 * <p> Al momento dell'apertura della finestra di dialogo tutti i campi sono disattivati tranne il campo percorso  che una volta selezionati il
 * <p> file da aggiunge  i campi titolo, autore, anno numero di pagine si attiva  .
 * <p> Il campo titolo o autore non possono essere vuoti  .</p>
 *
 * @author Bonsu
 */
public class AddDialogBox extends java.awt.Dialog {

    private static TableModel mod;
    private static Libreria Lyb;
    private static File []file;
    private int count;
   // private boolean mode;
    private  JFileChooser fChooser;
    private String path;
    private String formato;

    /**
     * <p>Il metodo costruttore che permette la creazione la finestra di dialogo della classe . </p> 
     * <p> Il costruttore prende in ingresso cinque parametri
     * @param parent  il frame principale
     * @param modal  variabile booleano
     * @param tab   e' il modello della mia tabella
     * @param lyb   rappresenta la libreria
     * @param file  contera i nomi dei percorsi selezionati
     */
    public AddDialogBox(java.awt.Frame parent, boolean modal, TableModel tab, Libreria lyb, File file[]) {
        super(parent, modal);
        mod = tab;
        Lyb = lyb;
        this.file = file;
        //this.mode=mode;
        
         count = 1;
         this.setTitle("Add");
        initComponents();
        this.setSize(516, 448);
        this.setResizable(false);
        fieldDisable();
        
       
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        titoloTF = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        autoreTF = new javax.swing.JTextField();
        annoTF = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        numPagineTF = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        percorsoTF = new javax.swing.JTextField();
        percorsoBtt = new javax.swing.JButton();
        cancelBtt = new javax.swing.JButton();
        aggiungeBtt = new javax.swing.JButton();
        jSeparator1 = new javax.swing.JSeparator();

        setBackground(new java.awt.Color(204, 204, 204));
        setName("Add Dialog Box"); // NOI18N
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                closeDialog(evt);
            }
        });
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel1.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        jLabel1.setText("Titolo");
        add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(25, 52, 113, 45));
        jLabel1.getAccessibleContext().setAccessibleName("jLabel1");

        titoloTF.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        titoloTF.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                titoloTFActionPerformed(evt);
            }
        });
        add(titoloTF, new org.netbeans.lib.awtextra.AbsoluteConstraints(185, 60, 210, 30));

        jLabel2.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        jLabel2.setText("Autore");
        add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(25, 110, 113, 30));

        autoreTF.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        add(autoreTF, new org.netbeans.lib.awtextra.AbsoluteConstraints(185, 110, 210, 30));

        annoTF.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        add(annoTF, new org.netbeans.lib.awtextra.AbsoluteConstraints(183, 170, 212, 30));

        jLabel3.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        jLabel3.setText("Anno");
        add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(25, 170, 103, 30));

        numPagineTF.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        add(numPagineTF, new org.netbeans.lib.awtextra.AbsoluteConstraints(183, 230, 212, 30));

        jLabel4.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        jLabel4.setText("Numero Pagine");
        add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(25, 230, 113, 30));

        jLabel5.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        jLabel5.setText("Percorso");
        add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 290, 113, 30));

        percorsoTF.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        percorsoTF.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                percorsoTFActionPerformed(evt);
            }
        });
        add(percorsoTF, new org.netbeans.lib.awtextra.AbsoluteConstraints(180, 290, 212, 30));

        percorsoBtt.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        percorsoBtt.setText("Percorso");
        percorsoBtt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                percorsoBttActionPerformed(evt);
            }
        });
        add(percorsoBtt, new org.netbeans.lib.awtextra.AbsoluteConstraints(400, 290, 90, 30));

        cancelBtt.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        cancelBtt.setText("Cancel");
        cancelBtt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancelBttActionPerformed(evt);
            }
        });
        add(cancelBtt, new org.netbeans.lib.awtextra.AbsoluteConstraints(300, 380, 90, 30));

        aggiungeBtt.setFont(new java.awt.Font("Arial", 2, 14)); // NOI18N
        aggiungeBtt.setText("Aggiungi");
        aggiungeBtt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                aggiungeBttActionPerformed(evt);
            }
        });
        add(aggiungeBtt, new org.netbeans.lib.awtextra.AbsoluteConstraints(400, 380, 90, 30));
        add(jSeparator1, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 390, -1, -1));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    /**
     * Closes the dialog
     */
    private void closeDialog(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_closeDialog
        setVisible(false);
        dispose();
    }//GEN-LAST:event_closeDialog

    private void cancelBttActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cancelBttActionPerformed
        // TODO add your handling code here:
        this.setVisible(false);

        this.dispose();
    }//GEN-LAST:event_cancelBttActionPerformed

    
    
    
    private void percorsoBttActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_percorsoBttActionPerformed
      percorsoTF.setText("");
         fChooser = new JFileChooser();
        fChooser.setMultiSelectionEnabled(true);
        /*
        FileFilter ff = new FileNameExtensionFilter("Ebook","epub","pdf","mobi","html");
        FileFilter ff1 = new FileNameExtensionFilter(".epub","epub");
        FileFilter f2 = new FileNameExtensionFilter (".pdf","pdf");
        FileFilter f3 = new FileNameExtensionFilter (".mobi","mobi");
        FileFilter f4 = new FileNameExtensionFilter (".html",".html");
        
        fChooser.addChoosableFileFilter(ff);
        fChooser.addChoosableFileFilter(ff1);
        fChooser.addChoosableFileFilter(f2);
        fChooser.addChoosableFileFilter(f3);
        fChooser.addChoosableFileFilter(f4);
        
       
        int val = fChooser.showOpenDialog(null);
        file = fChooser.getSelectedFiles();
        percorsoTF.setText(file[0].toString());
        */
        if(!percorsoTF.equals(""))
            fieldEnable();
        
//IL CONTROLLO
       // fChooser.addChoosableFileFilter(ff1);    
        fChooser.setApproveButtonText("Seleziona");
        

    }//GEN-LAST:event_percorsoBttActionPerformed

    private void aggiungeBttActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_aggiungeBttActionPerformed
       
        formato=null; // string per contenere il formato del file 
        path = file[count-1].toString(); // string per calcolare il sufisso del faromato 
        
         formato = path.substring(path.length() - 4); //assegnazioen del suffisso calcolato a formato
       // controllo per vedere se formato e ugale a pdf o no  altrimenti assegno un altro formato 
         if (!formato.equals(".pdf") && !formato.equals(".doc")) {
            formato = path.substring(path.length() - 5);
        }
         //messaggio di errore se nessun percorso e stato selezioenato
        if (percorsoTF.equals("")){
            JOptionPane.showMessageDialog(this,"Nessun percorso selezionato ");
            fieldDisable();
        }
        else { 
            
           fieldEnable();
          
                    String title=titoloTF.getText();
                    String autor = autoreTF.getText();
                    String yrs= annoTF.getText();
                    String numpg=numPagineTF.getText();
                    if(title.isEmpty() && autor.isEmpty()){
                        JOptionPane.showMessageDialog(this,"titolo ed autore non possono essere entrambi vuoti");
                                            }
                    else{               
                if (count <= file.length) {
                    switch (formato) {
                        case ".pdf":
                            Lyb.addPdfBook(title, autor, yrs, numpg, path);
                        break;
                        case ".html":
                            Lyb.addHtmlEBook(title, autor, yrs, numpg, path);
                        break;    
                        case ".epub":
                            Lyb.addEpubBook(title, autor, yrs, numpg, path);
                        break;
                        case ".mobi":
                            Lyb.addMobiEBook(title, autor, yrs, numpg, path);
                        break;
                        case ".doc":
                            Lyb.addDocEBook(title,autor,yrs,numpg, path);
                        break;
                    }

                  mod.fireTableDataChanged();
            }
            if (file.length == count){ 
              this.dispose();
            }
            /*
            if(file.length == (count+1)){
                aggiungeBtt.setText("");
            }
            */
            count++;
            try{
            if(file.length!=0) {
                percorsoTF.setText(file[count-1].toString());
                  fieldReset(); 
            }
            }catch(Exception e){
            //    System.out.println("sono un fungo ");
            }
            }

    }//GEN-LAST:event_aggiungeBttActionPerformed
  
        }
        
       
    private void titoloTFActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_titoloTFActionPerformed
    }//GEN-LAST:event_titoloTFActionPerformed

    private void percorsoTFActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_percorsoTFActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_percorsoTFActionPerformed

    
       /**
        * <p> Metodo che disattiva i camnpi  dei dettagli. </p>
        */
        
    public void fieldDisable() {
        titoloTF.setEditable(false);
        autoreTF.setEditable(false);
        annoTF.setEditable(false);
        numPagineTF.setEditable(false);
    }
     /**
        * <p> Attiva i camnpi per l'inseritmeto dei dettagli. </p>
        */
    public void fieldEnable(){
        titoloTF.setEditable(true);
        autoreTF.setEditable(true);
        annoTF.setEditable(true);
        numPagineTF.setEditable(true);
    }
     /**
        * <p> Resetta i camnpi per  dei dettagli a vuoto. </p>
        */
    public void fieldReset(){
       titoloTF.setText("");
            autoreTF.setText("");
            annoTF.setText("");
            numPagineTF.setText("");
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            @Override
            public void run() {
                AddDialogBox dialog; 
                  dialog= new AddDialogBox(new java.awt.Frame(), true, mod, Lyb, file);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton aggiungeBtt;
    private javax.swing.JTextField annoTF;
    private javax.swing.JTextField autoreTF;
    private javax.swing.JButton cancelBtt;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JTextField numPagineTF;
    private javax.swing.JButton percorsoBtt;
    private javax.swing.JTextField percorsoTF;
    private javax.swing.JTextField titoloTF;
    // End of variables declaration//GEN-END:variables
}
